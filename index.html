<!DOCTYPE html>

<head>
    <title>Emoji Analysis</title>
    
    <script src="//d3js.org/d3.v3.min.js"></script>
	<link rel="stylesheet" type="text/css" href="emojiStyle.css">
	
    <meta charset="utf-8">
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-73887344-1', 'auto');
	  ga('send', 'pageview');

	</script>
    
</head>

<body bgcolor="white">
	<h1 align="center">2016 Presidential Candidates Directed Tweets (@) Emoji Analysis</h1>
	
	<div class="container">

	<div class='debateButtons'>
		<form onClick="changeDebate()">
		  <input type="radio" name="debate" value="20161005" checked="checked"> Oct. 5 VP Debate<br>
		  <input type="radio" name="debate" value="20160926"> Sept. 26 Pres Debate<br>
		</form>
	</div>
	
	<div class='candidateButtons'>
		<span id="candidatedisplay"></span>
		<button id="HillaryClinton" onclick="changeCandidate(counts,this.id)" style="background-color: blue" class="candidateButton">Hillary Clinton (D)</button>
		<button id="realDonaldTrump" onclick="changeCandidate(counts,this.id)" style="background-color: red" class="candidateButton">Donald Trump (R)</button>
	</div>
	
	<div class='dateButtons'>
		<span id="datedisplay"></span>
		<input type="range" min="0" max="21" step="1" value="0" id="datevalue">
		<button name="play" id="play">Play</button>
	</div>
	
    </div>

    <svg width="1350" height="700"></svg>
	
    <script>
    
	var candidateDefault = 'HillaryClinton';
    var dateDefault = 0;
	
    // Creating global variable to hold the data table
    var counts;
    var dates;
    var ecodes;
	
	// Variables to hold where latest button values
    var dateSelected;
    var candidate;
	
	function getData(){
		// Get Emoji HTML Codes	
		d3.json("e_codes.json", function(data){
			//ecodes = JSON.parse(data);
			ecodes = data
			console.log(ecodes);
			console.log(typeof(ecodes));
		});
		
		// Get Data for the Selected Debate
		console.log(getRadioValue('debate'));
		//fileName = "emoji_counts_minute_" +getRadioValue('debate')+".json"
		fileName = "emoji_counts_minute.json"
		d3.json(fileName, function(data) {
			counts = data;

			candidate = candidateDefault;
			makechart(counts, +dateDefault, candidateDefault);

		});
		
		
	}
	getData();
		
	function changeDebate(){
		// Pause Play if Change Debate
		clearInterval(timer);
		playButton.html("Play");
		running = false;
		
		// Return Slider and Slider Value to Zero
		sliderValue = 0;
        document.getElementById("datevalue").value = +sliderValue;
		
		// Get the New Data & Make Chart
		getData();
	}
		
	var running = false;
	var timer;
	var sliderValue = 0;
		
	var playButton = d3.select("#play");
	playButton.on("click", function() {
		
		var duration = 3000,
			maxstep = 2011,
			minstep = 2000;

		if (running == true) {
			clearInterval(timer);
			playButton.html("Play");
			running = false;
			
			//clearInterval(timer);

		} 
		/*
		else if (running == true && $("#slider").val() == maxstep) {
			 running = true;
			 $("button").html("Play1");


		} 
*/
		else if (running == false) {

			playButton.html("Pause");
			playUpdate();
			//sliderValue = $("#slider").val();

			//timer = setInterval( function(){
			//		if (sliderValue < maxstep){
			//			sliderValue++;
			//			$("#slider").val(sliderValue);
			//			$('#range').html(sliderValue);
			//		}
			//		$("#slider").val(sliderValue);
			//		update();

			//}, duration);
			running = true;


		}

	}
				  );
		
	function playUpdate(){
		// For each date in List
		//sliderValue = 0;
		var maxstep = dates.length-1;
		var sliderButton = d3.select("#datevalue");
		timer = setInterval(function() {
			if (sliderValue < maxstep){
				sliderValue++;
				sliderButton.property("value", sliderValue);
				makechart(counts, sliderValue, candidate);
				
			}
		}, 500);
	};
		        
    function makechart(data, dateSelected, candidate) {
		
		// clear bars and labels
        // d3.selectAll("svg > *").remove();
        d3.selectAll(".bar").remove(); 
        d3.selectAll(".labels").remove();
        d3.selectAll(".x.axis").remove();
        d3.selectAll(".y.axis").remove();
		
        
		var windowWidth = window.innerWidth - 100;
    	var windowHieght = window.innerHeight - 200;
		
		var margin = {top: 20, right: 20, bottom: 150, left: 70},
			width = windowWidth - margin.left - margin.right,
			height = windowHieght - margin.top - margin.bottom;
		
		var svg = d3.select("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom + 50)
			.attr("id","mySVG")
		  .append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
		var x = d3.scale.ordinal()
			.rangeRoundBands([0, width], .1);

		var y = d3.scale.linear()
			.range([height, 0]);

		var xAxis = d3.svg.axis()
			.scale(x)
			.orient("bottom");

		var yAxis = d3.svg.axis()
			.scale(y)
			.orient("left")
			.ticks(10);

        dates = d3.keys(data[candidate]).sort();
		
		// Change the Range of the Input Scale by Candidate's Date List
        document.getElementById("datevalue").max = dates.length-1
		
        //console.log(dates)
        //console.log(dates.sort())
        selected_data=data[candidate][dates[dateSelected]];
        
        d3.select("#datedisplay").text(dates[dateSelected])
        console.log(dateSelected);
        console.log(selected_data);
		
		d3.select("#candidatedisplay").text("Selected Candidate: '"+candidate+"' ");
        

        // Create x and y axis
        x.domain(d3.keys(selected_data));
        y.domain([
            0,
            200
          ]);
        
        svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis)
        .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", function(d) {
                return "rotate(-35)" 
                });

        svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
        .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Frequency");
        
        svg.selectAll(".bar")
          .data(d3.entries(selected_data))
        .enter().append("rect")
          .attr("class", "bar")
          .attr("x", function(d) { return x(d.key); })
          .attr("width", x.rangeBand())
          .attr("y", function(d) { return y(d.value); })
          .attr("height", function(d) { return height - y(d.value); })
			.attr("fill", function(){
			if (candidate == 'realDonaldTrump'){
				return '#e60000'} else {return 'blue'};});

      svg.selectAll(".labels")
          .data(d3.entries(selected_data))
        .enter().append("text")
          .html(function(d) { return ecodes[d.key]['htmlcode']; })
            .attr("x", function(d) { return x(d.key); })
            .attr("y", function(d) { return y(d.value) - 5; })
            //.attr("fill", "blue")
            .attr("font-size","20px")
            //.attr("text-anchor","middle")
            .attr("class","labels")
            ;
    };
        
    function changeCandidate(data, id) {
        candidate = id;
        console.log(id);
        
        dates = d3.keys(data[candidate]).sort();
        
        // Change the Range of the Input Scale by Candidate's Date List
        document.getElementById("datevalue").max = dates.length-1
        console.log(document.getElementById("datevalue").max)
        
        // Return Slider Input Value to Default
        document.getElementById("datevalue").value = +sliderValue;
		
        d3.select("#candidatedisplay").text("Selected Candidate: "+candidate)
        makechart(counts, sliderValue, candidate);
		
		// Pause Play if Change Candidate
		clearInterval(timer);
		playButton.html("Play");
		running = false;
    }


    function type(d) {
      d.frequency = +d.frequency;
      return d;
    }
		
	function getRadioValue(theRadioGroup){
		var elements = document.getElementsByName(theRadioGroup);
		for (var i = 0, l = elements.length; i < l; i++)
		{
			if (elements[i].checked)
			{
				return elements[i].value;
			}
		}
	}
         
    // Update the graph when the input date from range changes 
    d3.select("#datevalue").on("input", function() {
        sliderValue = this.value;
        // console.log(dateSelected)
        //console.log(dates[+dateSelected])
        
        d3.select("#datedisplay").text(dates[sliderValue])
        makechart(counts, sliderValue, candidate);
    });
        
	// Change size of the plot when the browser window is re-sized
    window.onresize = function(event) {
        makechart(counts, sliderValue, candidate);
        //console.log(window.innerHeight);
        //console.log(window.innerWidth)
    };
	
        
    </script>
    
    <p>Note: These graphs were produced by the University of Virginia's Twitter Visualization Project. Data were acquired via the Twitter API, collecting all @candidate tweets available for that day. This analysis reflects the availability and sampling methods of information made available through the Twitter API. For questions, please contact Hope McIntyre (hm7zg@virginia.edu), Paul Freedman (freedman@virginia.edu), or David Leblang (dal7w@virginia.edu).</p>